on:
  push:
    branches: [ main ]
  workflow_dispatch:    # allows manual runs

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send a Discord message
        uses: actions/github-script@v6
        with:
          script: |
            const commit = github.event.head_commit;
            if (!commit) {
              console.log("No head_commit found (this was a manual run), skipping notification.");
              return;
            }
            const repo = github.event.repository.full_name;
            const msg = `📝 **${repo}** pushed by **${commit.author.name}**:\n> ${commit.message}\n${commit.url}`;
            await fetch(process.env.DISCORD_WEBHOOK, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ content: msg })
            });
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
